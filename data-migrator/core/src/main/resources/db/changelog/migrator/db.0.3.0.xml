<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under
  ~ one or more contributor license agreements. See the NOTICE file distributed
  ~ with this work for additional information regarding copyright ownership.
  ~ Licensed under the Camunda License 1.0. You may not use this file
  ~ except in compliance with the Camunda License 1.0.
  -->
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

  <changeSet id="tag_before_modify_c8_key_column" author="Camunda">
    <tagDatabase tag="tag_before_modify_c8_key_column"/>
  </changeSet>

  <changeSet id="modify_c8_key_column_to_varchar" author="Camunda">
    <!-- Drop index first as SQL Server doesn't allow modifying indexed columns -->
    <dropIndex tableName="${prefix}MIGRATION_MAPPING"
               indexName="${prefix}IDX_MIGRATION_MAPPING_C8_KEY"/>

    <modifyDataType tableName="${prefix}MIGRATION_MAPPING"
                    columnName="C8_KEY"
                    newDataType="VARCHAR(255)"/>

    <!-- Recreate the index after column modification -->
    <createIndex tableName="${prefix}MIGRATION_MAPPING"
                 indexName="${prefix}IDX_MIGRATION_MAPPING_C8_KEY">
      <column name="C8_KEY"/>
    </createIndex>

    <modifySql dbms="oracle">
      <replace replace="VARCHAR(255)" with="VARCHAR2(255)"/>
    </modifySql>
  </changeSet>

</databaseChangeLog>
